---
name: tdd
description: TDD（テスト駆動開発）サイクルを実行する。新機能の実装、バグ修正、リファクタリングの開始時に使用する。「TDDで実装して」「テストファーストで」「/tdd」で発動。
---

# TDD（テスト駆動開発）サイクル

このスキルはTDDの Red → Green → Refactor サイクルをガイドします。

## 使い方
```
/tdd ダメージ計算機能
/tdd 距離システム
```

## 実行フロー

### STEP 1: 探索
1. 関連する既存コード・型定義・テストを確認
2. `docs/PROJECT.md` で仕様を確認
3. 実装方針を整理

### STEP 2: テスト設計
1. **test-designer** サブエージェントでテストケースを設計
2. テストファイルのパス: `src/__tests__/{機能名}.test.ts`
3. 正常系・異常系・境界値をカバー

### STEP 3: テストを書く（Red）
1. 失敗するテストを書く
2. `npm test` で失敗を確認
3. **テストをコミット**（実装前に固定）

```bash
git add src/__tests__/{機能名}.test.ts
git commit -m "test: {機能名}のテストを追加"
```

### STEP 4: 実装を書く（Green）
1. テストが通る**最小限の実装**を書く
2. `npm test` で成功を確認
3. ⚠️ **テストコードは変更しない**
4. **実装をコミット**

```bash
git add src/{機能名}.ts
git commit -m "feat: {機能名}を実装"
```

### STEP 5: リファクタリング（Refactor）
1. コードを改善（テストは変更しない）
2. `npm test` で成功を維持
3. 必要ならコミット

### STEP 6: 検証
1. **spec-checker** で仕様との整合性を確認
2. バトル関連なら **battle-logic-reviewer** で検証
3. 問題があれば修正

## ルール

- **テストファースト**: 実装前に必ずテストを書く
- **テストの不変性**: 実装フェーズでテストを変更しない
- **小さなステップ**: 一度に1つの機能をテスト→実装
- **コミット単位**: テストと実装は別コミット

## 完了条件

- [ ] テストが書かれ、コミットされた
- [ ] 実装が書かれ、全テストが通る
- [ ] 実装がコミットされた
- [ ] spec-checker で仕様整合性を確認した
