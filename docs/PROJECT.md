# モンスター対戦アプリ - プロジェクト仕様書

## 概要

モンスターを1対1で戦わせる対戦アプリ。
バトルシステムは「ドラゴンシーズ 最終進化形態」をベースに、オリジナル要素（スタンスシステム）を追加。

### 対応プラットフォーム
- Android
- iPhone

---

## 開発フェーズ

### 第1フェーズ（初期リリース）
- 挑戦モード（ステージ制）
- 自由対戦（CPU）
- 自由対戦（ローカルオンライン）
- 育成なし・キャラ固定パラメータ
- 属性システムなし

### 第2フェーズ（将来）
- 育成モード
- ストーリーモード
- 属性システム（火・雷・水の3すくみ）
- その他検討中

---

## バトルシステム

### TCB（ツインコマンドバトル）

毎ターン、7つのコマンドから **2つを順番に選択** して同時実行する。

#### 実行順序
1. 双方の1stコマンドを同時処理
2. 双方の2ndコマンドを同時処理

#### コマンド一覧

| # | コマンド | 効果 |
|---|---------|------|
| 1 | 前進 | 相手との距離を1段階縮める |
| 2 | 後退 | 相手との距離を1段階広げる |
| 3 | 武器攻撃 | 近距離で物理ダメージを与える |
| 4 | 特殊攻撃 | 全距離で使用可能な攻撃 |
| 5 | リフレクター | 特殊攻撃を防御/反射する |
| 6 | スタンスA | スタンス切替（現在のスタンスにより表示変動） |
| 7 | スタンスB | スタンス切替（現在のスタンスにより表示変動） |

---

### 距離システム

3段階: **近距離 / 中距離 / 遠距離**

- 1コマンドで1段階移動
- 双方が同方向に移動した場合は2段階移動する

#### 距離変動表

| A | B | 近→ | 中→ | 遠→ |
|---|---|-----|-----|-----|
| 前進 | 前進 | 近(変わらず) | 近(-2) | 近(-2) |
| 前進 | 後退 | 近(相殺) | 中(相殺) | 遠(相殺) |
| 後退 | 前進 | 近(相殺) | 中(相殺) | 遠(相殺) |
| 後退 | 後退 | 遠(+2) | 遠(+2) | 遠(変わらず) |

---

### コマンド優先順位（じゃんけん構造）

```
武器攻撃 > リフレクター > 特殊攻撃
```

- **武器攻撃 > 特殊攻撃**: 近距離で同時に出した場合、武器が先に発生し特殊を潰す
- **武器攻撃 > リフレクター**: 武器攻撃はリフレクターで防げない（貫通）
- **リフレクター > 特殊攻撃**: 特殊攻撃をリフレクターで無効化/反射

---

### 近距離マトリクス表

| A＼B | 前進 | 後退 | 武器 | 特殊 | リフレクター | スタンス切替 |
|------|------|------|------|------|-------------|------------|
| **前進** | 距離:近 | 距離:近(相殺) | A被弾(武器) | A被弾(特殊) | - | - |
| **後退** | 距離:近(相殺) | 距離:中 | 空振り(Aが離れた) | A被弾(中距離で命中) | - | - |
| **武器** | B被弾 | 空振り(Bが離れた) | 相打ち(両者被弾) | A武器命中＋B特殊潰れ | B被弾(武器貫通) | B被弾 |
| **特殊** | B被弾 | B被弾(中距離で命中) | B武器命中＋A特殊潰れ | 相打ち(両者被弾) | A特殊反射or無効 | B被弾 |
| **リフレクター** | - | - | A被弾(武器貫通) | B特殊反射or無効 | - | - |
| **スタンス切替** | - | - | A被弾 | A被弾 | - | - |

### 中距離マトリクス表

| A＼B | 前進 | 後退 | 武器 | 特殊 | リフレクター | スタンス切替 |
|------|------|------|------|------|-------------|------------|
| **前進** | 距離:近 | 距離:中(相殺) | 近距離になり被弾(武器) | A被弾(特殊) | - | - |
| **後退** | 距離:中(相殺) | 距離:遠 | 空振り(離れた) | A被弾(特殊) | - | - |
| **武器** | 近距離になり命中 | 空振り(離れた) | 両者空振り(中距離) | A空振り＋B特殊命中 | A空振り | A空振り |
| **特殊** | B被弾 | B被弾 | B空振り＋A特殊命中 | 相打ち(両者被弾) | A特殊反射or無効 | B被弾 |
| **リフレクター** | - | - | B空振り | B特殊反射or無効 | - | - |
| **スタンス切替** | - | - | B空振り | A被弾 | - | - |

### 遠距離マトリクス表

| A＼B | 前進 | 後退 | 武器 | 特殊 | リフレクター | スタンス切替 |
|------|------|------|------|------|-------------|------------|
| **前進** | 距離:近 | 距離:遠(相殺) | 中距離になり空振り(武器) | A被弾(特殊) | - | - |
| **後退** | 距離:遠(相殺) | 距離:遠(変わらず) | 空振り | A被弾(特殊) | - | - |
| **武器** | 中距離になり空振り | 空振り | 両者空振り | A空振り＋B特殊命中 | A空振り | A空振り |
| **特殊** | B被弾 | B被弾 | B空振り＋A特殊命中 | 相打ち(両者被弾) | A特殊反射or無効 | B被弾 |
| **リフレクター** | - | - | B空振り | B特殊反射or無効 | - | - |
| **スタンス切替** | - | - | B空振り | A被弾 | - | - |

---

## パラメータ

### モンスターパラメータ（第1フェーズ: 種族ごと固定値）

| パラメータ | 役割 |
|------------|------|
| **HP** | 体力。0で敗北 |
| **腕力** | 武器攻撃のダメージに影響 |
| **特殊** | 特殊攻撃のダメージに影響 |
| **素早さ** | 回避率に影響（唯一の回避要素） |
| **丈夫さ** | 防御力。武器攻撃の被ダメージを軽減 |

### ダメージ計算式

| 攻撃種別 | 計算式 |
|----------|--------|
| 武器攻撃 | `max(腕力 × 武器倍率 - 丈夫さ, 1)` |
| 特殊攻撃 | `特殊 × 技倍率` |
| リフレクター反射 | `相手の特殊ダメージ × 反射率` |

#### 補足
- **丈夫さは武器攻撃にのみ有効**。特殊攻撃は丈夫さで軽減できない（リフレクターで防ぐ）
- 最低ダメージは **1**（0以下にはならない）

### 回避

| 項目 | 内容 |
|------|------|
| 計算式 | `素早さ × 係数` |
| 上限 | **最大25%** |
| 対象 | 武器攻撃・特殊攻撃どちらも回避可能 |
| 回避時 | ダメージ0 |
| 例外 | **近距離で武器 vs 武器は回避不可（必中相打ち）** |

---

## 装備（第1フェーズ: キャラ固定）

### 武器

| 項目 | 内容 |
|------|------|
| 名前 | キャラごとに固有 |
| 武器倍率 | ダメージ計算に使用 |

### リフレクター

| 項目 | 内容 |
|------|------|
| 名前 | キャラごとに固有 |
| 反射可能回数 | 反射成功時に1消費。0になっても無効化は可能 |
| 反射率 | 相手の特殊攻撃ダメージに対する反射ダメージの割合 |

---

## 特殊攻撃

| 項目 | 内容 |
|------|------|
| 仕様 | 全キャラ共通（エフェクトは種族ごとに異なる） |
| 使用回数 | キャラごとに固定値 |
| 回数超過時 | 攻撃力が **半減** する（使用回数＝全力で打てる回数） |

---

## スタンスシステム（オリジナル要素）

### 概要

バトル中にスタンスを切り替えることで、攻撃力と防御力のバランスを変化させる。

### スタンス一覧

| スタンス | 腕力・特殊 | 丈夫さ |
|---------|-----------|--------|
| **通常** | ×1.0 | ×1.0 |
| **攻勢** | ×1.3 | ×0.7 |
| **守勢** | ×0.7 | ×1.3 |

### 仕様

| 項目 | 内容 |
|------|------|
| 初期状態 | 通常 |
| 切替方法 | どのスタンスからでも1回で任意のスタンスに切替可能 |
| 切替コスト | コマンド1枠消費（無防備になる） |
| 被弾時 | 攻撃を受けてもスタンス切替は中断されない |
| 維持 | 再度切り替えるまで永続 |

### コマンドUI表示

| 現在のスタンス | スタンスA表示 | スタンスB表示 |
|--------------|-------------|-------------|
| 通常 | →攻勢 | →守勢 |
| 攻勢 | →通常 | →守勢 |
| 守勢 | →通常 | →攻勢 |

---

## 勝敗条件

| 条件 | 結果 |
|------|------|
| 相手のHPを0にする | 勝利 |
| 制限時間（2分）終了 | HP残量が多い方が勝利 |
| ギブアップ | 敗北 |

### 補足
- コマンド入力時間は制限時間に含まない
- 第1フェーズではキャラのロスト（永久消失）なし

---

## モンスターデータ構造

```
モンスター {
  名前: string
  HP: number
  腕力: number
  特殊: number
  素早さ: number
  丈夫さ: number
  特殊攻撃使用回数: number

  武器 {
    名前: string
    倍率: number
  }

  リフレクター {
    名前: string
    反射可能回数: number
    反射率: number  // 0.0〜1.0
  }
}
```

---

## ゲームモード（第1フェーズ）

### 挑戦モード
- ステージ制で対戦するモード（チュートリアル的位置づけ）
- 初期は使用可能キャラ1種類のみ（バランス型）
- ステージごとに新しい種族が敵として出現
- 敵を倒すとステージクリア＋そのキャラが使用可能になる

### 自由対戦（CPU）
- 挑戦モードで解放されたキャラから選択して対戦

### 自由対戦（ローカルオンライン）
- 挑戦モードで解放されたキャラから選択して対戦
- ※詳細仕様は未定

---

## 未決定事項

- [ ] モンスターの種族数・各種族のパラメータ具体値
- [ ] 初期キャラ（バランス型）の詳細
- [ ] 挑戦モードのステージ数・難易度設計
- [ ] 自由対戦（ローカルオンライン）の通信仕様
- [ ] CPU対戦のAIロジック
- [ ] 回避率の具体的な係数
- [ ] 特殊攻撃の技倍率
- [ ] 制限時間終了時にHP同値の場合の処理
- [ ] バトル開始時の初期距離
